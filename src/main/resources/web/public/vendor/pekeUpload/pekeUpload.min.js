!function(e){e.fn.pekeUpload=function(r){var i={dragMode:!1,dragText:"Drag and Drop your files here",bootstrap:!1,btnText:"Browse files...",allowedExtensions:"",invalidExtError:"Invalid File Type",maxSize:0,sizeError:"Size of the file is greather than allowed",showPreview:!0,showFilename:!0,showPercent:!0,showErrorAlerts:!0,errorOnResponse:"There has been an error uploading your file",onSubmit:!1,url:"upload.php",data:null,limit:0,limitError:"You have reached the limit of files that you can upload",delfiletext:"Remove from queue",onFileError:function(e,r){},onFileSuccess:function(e,r){}},r=e.extend(i,r),a={obj:e(this),files:[],uparea:null,container:null,uploadedfiles:0,hasErrors:!1,init:function(){this.replacehtml(),this.uparea.on("click",function(){a.selectfiles()}),r.dragMode&&this.handledragevents(),this.handlebuttonevents(),e(document).on("click",".pkwrncl",function(){e(this).parent("div").remove()}),r.onSubmit&&this.handleFormSubmission()},replacehtml:function(){var i=null;switch(r.dragMode){case!0:switch(r.bootstrap){case!0:i='<div class="well well-lg pkuparea pkdragarea" style="cursor:pointer"><h4>'+r.dragText+"</h4></div>";break;case!1:i='<div class="pekeupload-drag-area pkuparea pkdragarea" style="cursor:pointer"><h4>'+r.dragText+"</h4></div>"}break;case!1:switch(r.bootstrap){case!0:i='<a href="javascript:void(0)" class="btn btn-primary btn-upload pkuparea"> <i class="glyphicon glyphicon-upload"></i> '+r.btnText+"</a>";break;case!1:i='<a href="javascript:void(0)" class="pekeupload-btn-file pkuparea">'+r.btnText+"</a>"}}this.obj.hide(),this.uparea=e(i).insertAfter(this.obj),this.container=e('<div class="pekecontainer"><ul></ul></div>').insertAfter(this.uparea)},selectfiles:function(){this.obj.click()},handlebuttonevents:function(){e(document).on("change",this.obj.selector,function(){a.checkFile(a.obj[0].files[0])}),e(document).on("click",".pkdel",function(){var r=e(this).parent("div").parent("div");a.delAndRearrange(r)})},handledragevents:function(){e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("drop",function(e){e.stopPropagation(),e.preventDefault()}),this.uparea.on("dragenter",function(r){r.stopPropagation(),r.preventDefault(),e(this).css("border","2px solid #0B85A1")}),this.uparea.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),this.uparea.on("drop",function(r){e(this).css("border","2px dotted #0B85A1"),r.preventDefault();for(var i=r.originalEvent.dataTransfer.files,t=0;t<i.length;t++)a.checkFile(i[t])})},checkFile:function(e){error=this.validateFile(e),error?(r.showErrorAlerts&&this.addWarning(error),this.hasErrors=!0,r.onFileError(e,error)):(this.files.push(e),this.files.length>r.limit&&r.limit>0?(this.files.splice(this.files.length-1,1),r.showErrorAlerts&&this.addWarning(r.limitError,this.obj),this.hasErrors=!0,r.onFileError(e,error)):(this.addRow(e),0==r.onSubmit&&this.upload(e,this.files.length-1)))},addWarning:function(i,a){var t=null;switch(r.bootstrap){case!0:t='<div class="alert alert-danger"><button type="button" class="close pkwrncl" data-dismiss="alert">&times;</button> '+i+"</div>";break;case!1:t='<div class="alert-pekeupload"><button type="button" class="close pkwrncl" data-dismiss="alert">&times;</button> '+i+"</div>"}a?e(t).insertBefore(a):this.container.append(t)},validateFile:function(e){return this.checkExtension(e)?this.checkSize(e)?null:r.sizeError:r.invalidExtError},checkExtension:function(i){if(""==r.allowedExtensions)return!0;var a=i.name.split(".").pop().toLowerCase(),t=r.allowedExtensions.split("|");return-1==e.inArray(a,t)?!1:!0},checkSize:function(e){return 0==r.maxSize?!0:e.size>r.maxSize?!1:!0},addRow:function(i){var a=this.files.length-1;switch(r.bootstrap){case!0:var t=e('<div class="row pkrw" rel="'+a+'"></div>').appendTo(this.container);if(r.showPreview){var o=e('<div class="col-lg-2 col-md-2 col-xs-4"></div>').appendTo(t);this.previewFile(o,i)}var s=e('<div class="col-lg-8 col-md-8 col-xs-8"></div>').appendTo(t);if(r.showFilename&&s.append('<div class="filename">'+i.name+"</div>"),0==r.notAjax){var n=e('<div class="progress"><div class="pkuppbr progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="min-width: 2em;"></div></div>').appendTo(s);r.showPercent&&n.find("div.progress-bar").text("0%")}var l=e('<div class="col-lg-2 col-md-2 col-xs-2"></div>').appendTo(t);e('<a href="javascript:void(0);" class="btn btn-danger pkdel">'+r.delfiletext+"</a>").appendTo(l);break;case!1:var t=e('<div class="pekerow pkrw" rel="'+a+'"></div>').appendTo(this.container);if(r.showPreview){var o=e('<div class="pekeitem_preview"></div>').appendTo(t);this.previewFile(o,i)}var s=e('<div class="file"></div>').appendTo(t);if(r.showFilename&&s.append('<div class="filename">'+i.name+"</div>"),0==r.notAjax){var n=e('<div class="progress-pekeupload"><div class="pkuppbr bar-pekeupload pekeup-progress-bar" style="min-width: 2em;width:0%"><span></span></div></div>').appendTo(s);r.showPercent&&n.find("div.bar-pekeupload").text("0%")}var l=e('<div class="pkdelfile"></div>').appendTo(t);e('<a href="javascript:void(0);" class="delbutton pkdel">'+r.delfiletext+"</a>").appendTo(l)}},previewFile:function(i,a){var t=a.type.split("/")[0];switch(t){case"image":var o=window.URL.createObjectURL(a);e('<img class="thumbnail" src="'+o+'" height="64" />').appendTo(i);break;case"video":var o=window.URL.createObjectURL(a);e('<video src="'+o+'" width="100%" controls></video>').appendTo(i);break;case"audio":var o=window.URL.createObjectURL(a);e('<audio src="'+o+'" width="100%" controls></audio>').appendTo(i);break;default:if(r.bootstrap){e('<i class="glyphicon glyphicon-file"></i>').appendTo(i)}else{e('<div class="pekeupload-item-file"></div>').appendTo(i)}}},upload:function(i,t){var o=new FormData;o.append(this.obj.attr("name"),i);for(var s in r.data)o.append(s,r.data[s]);e.ajax({url:r.url,type:"POST",data:o,dataType:"json",success:function(o){if(1==o||1==o.success)a.files[t]=null,e('div.row[rel="'+t+'"]').find(".pkuppbr").css("width","100%"),r.onFileSuccess(i,o);else{a.files.splice(t,1);var s=null;s=error in o?null:r.errorOnResponse,r.showErrorAlerts&&a.addWarning(s,e('div.row[rel="'+t+'"]')),e('div.row[rel="'+t+'"]').remove(),a.hasErrors=!0,r.onFileError(i,s)}},error:function(o,s,n){a.files.splice(t,1),r.showErrorAlerts&&a.addWarning(n,e('div.pkrw[rel="'+t+'"]')),a.hasErrors=!0,r.onFileError(i,n),e('div.pkrw[rel="'+t+'"]').remove()},xhr:function(){return myXhr=e.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(e){a.handleProgress(e,t)},!1),myXhr},complete:function(){r.onSubmit&&(a.uploadedfiles++,a.uploadedfiles==a.files.length&&0==a.hasErrors&&(a.obj.remove(),a.obj.parent("form").submit()))},cache:!1,contentType:!1,processData:!1})},handleProgress:function(i,a){if(i.lengthComputable){var t=(i.total,i.loaded,Number((100*i.loaded/i.total).toFixed(2))),o=e('div.pkrw[rel="'+a+'"]').find(".pkuppbr");o.css("width",t+"%"),r.showPercent&&o.text(t+"%")}},handleFormSubmission:function(){var e=this.obj.parent("form");e.submit(function(){a.hasErrors=!1,a.uploadedfiles=0;for(var e=0;e<a.files.length;e++)if(a.files[e])a.upload(a.files[e],e);else if(a.uploadedfiles++,a.uploadedfiles==a.files.length&&0==a.hasErrors)return a.obj.remove(),!0;return!1})},delAndRearrange:function(r){var i=r.attr("rel");a.files.splice(parseInt(i),1),r.remove(),a.container.find("div.pkrw").each(function(r){e(this).attr("rel",r)})}};a.init()}}(jQuery);